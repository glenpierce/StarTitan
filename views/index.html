<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body style="background-color:black">
<br>
<canvas id="myCanvas" width="1100" height="650" style="border:1px solid #000000;"></canvas>
<script>
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext("2d");
    ctx.font = "10px Arial";
    ctx.textAlign = "center";
    var map;

    canvas.addEventListener("click", onClick);
    function onClick(event){
        exampleSocket.send("click(" + event.x +", "+ event.y +")");
    }

    var exampleSocket = new WebSocket("ws://localhost:3001", "echo-protocol");
    exampleSocket.onopen = function (event) {
        exampleSocket.send("Map?");
    };
    exampleSocket.onmessage = function (event) {
        if(event.data.toString().substring(2,5) == "MAP") {
            console.log("Map received: " + event.data);
            map = JSON.parse(event.data);
            console.log(map.MAP.length);
            for(var i = 0; i < map.MAP.length; i++){
                if(map.MAP[i].i.type == "star"){
                    drawStar(map.MAP[i].i.x, map.MAP[i].i.y, map.MAP[i].i.id, map.MAP[i].i.science, map.MAP[i].i.industry, map.MAP[i].i.economy, map.MAP[i].i.ships, map.MAP[i].i.owner, ctx);
                }
                if(map.MAP[i].i.type == "ship"){
                    drawShip(map.MAP[i].i.x, map.MAP[i].i.y, map.MAP[i].i.ships, map.MAP[i].i.destination, map.MAP[i].i.owner, ctx)
                }
            }
        }
    };

    function drawStar(x, y, name, science, industry, economy, ships, owner, ctx){
        console.log(name);
        ctx.fillStyle="#FFFFFF";
        x = parseInt(x, 10);
        y = parseInt(y, 10);
        ctx.fillText(name, x, y + 15);
        ctx.fillText(economy, x - 7, y - 12);
        ctx.fillText(industry, x, y - 12);
        ctx.fillText(science, x + 7, y - 12);
        ships = parseInt(ships,10);
        if(ships > 0){
            ctx.fillText(ships, x, y + 23);
        }
        ctx.beginPath();
        ctx.arc(x,y,5,0,2*Math.PI);
        var gradient=ctx.createRadialGradient(x,y,2,x,y,5);
        gradient.addColorStop(0,"white");
        gradient.addColorStop(1,"black");
        ctx.fillStyle=gradient;
        ctx.fill();
    }

    function drawShip(x, y, ships, destination, owner, ctx){
        ctx.fillStyle="#FFFFFF";
        x = parseInt(x, 10);
        y = parseInt(y, 10);
        ctx.fillText(ships, x, y + 20);
        ctx.beginPath();
        ctx.moveTo(x,y);
        ctx.lineTo(x-4,y-3);
        ctx.lineTo(x-4,y+3);
        ctx.fill();
        for(i=0; i < map.MAP.length; i++){
            if(map.MAP[i].i.type=="star"){
                if(map.MAP[i].i.id == destination){
                    console.log("course charted from " + x + ", " + y + " to " + map.MAP[i].i.x + ", " + map.MAP[i].i.y);
                    ctx.strokeStyle="#FFFFFF";
                    ctx.lineWidth=1;
                    ctx.beginPath();
                    ctx.moveTo(x,y);
                    ctx.lineTo(map.MAP[i].i.x, map.MAP[i].i.y);
                    ctx.stroke();
                }
            }
        }
    }
</script>
</body>
</html>